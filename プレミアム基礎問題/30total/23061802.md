## 問題文

> **Note**
> いつも都道府県名や項目名を切り貼りしてDataFrameを操作していますが、今回の課題では都道府県名と項目名の文字列を触ることを封印します。代わりに地域コードと項目コードを使用します。Multindexを利用し、参照を活用してコーディングする練習を行います。
> また、抽出したデータでMatplotlibのグラフを描画しますが、コンストラクタで各種属性を指定せず、あとから各種属性を直接操作してグラフを完成させます。そういう課題です。


1. 以下のコードを実行しましょう。'SSESE-E-202.xlsx'のパスは適切に設定してください。これで'項目年次'を除くインデックス2列、カラム2行のマルチインデックスのデータフレームになります。
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl
import japanize_matplotlib
%matplotlib inline
from pprint import pprint
df = pd.read_excel('SSDSE-E-2023.xlsx', header=[0, 2], index_col=[0,1])
df.index.names=['地域コード','都道府県']
df.columns.names=['項目コード','項目名']
df.head()
```
2. まず、MultiIndexの利便性を高めるために、'地域コード'と'都道府県名'を抽出する関数 pref_listβ(*keys, data=df) を書きましょう。docstringは以下を使用しましょう。usageのコードをそのまま実行してこの結果が出るようにしましょう。
    ```code
    (args)
            *keys: 抽出対象の任意の数の地域コードを指定
            data : DataFram(デフォルトはdf)
    (usage)
            >>>pprint(pref_listβ('R13000', 'R14000', 'R15000', 'R16000', 'R17000', 'R18000'))
            [('R13000', '東京都'),
             ('R14000', '神奈川県'),
             ('R15000', '新潟県'),
             ('R16000', '富山県'),
             ('R17000', '石川県'),
             ('R18000', '福井県')]
    ```
（ヒント）リスト内包表記を使うと簡潔に記述できます。Multiindexの要素は表示の通りtupleの配列になっていること、Multiindexは外側がlevel=0, 内側がlevel=1であることを確認しましょう。


3. 続いて、columnsのMultiIndexから'項目コード'と'項目名'を抽出する関数 item_list(*keys, data=df) を書きましょう。docstringは以下を使用しましょう。usageのコードをそのまま実行してこの結果が出るようにしましょう。項目コードはカテゴリ毎にアルファベットと数字の階層構造になっています。usageのように項目コードの任意の先頭文字列で抽出範囲を決められるようにしましょう。
    ```code
    (args)
            *keys: 抽出対象の任意の数の項目コードを指定
            data : DataFrame(デフォルトはdf)
    (usage)
            >>>pprint(item_list('A13', 'E'))
            [('A1301', '15歳未満人口'),
             ('A1302', '15～64歳人口'),
             ('A1303', '65歳以上人口'),
             ('E1101', '幼稚園数'),
             ('E1501', '幼稚園在園者数'),
             ('E2101', '小学校数'),
             ('E2501', '小学校児童数'),
             ('E3101', '中学校数'),
             ('E3501', '中学校生徒数'),
             ('E4101', '高等学校数'),
             ('E4501', '高等学校生徒数'),
             ('E6101', '短期大学数'),
             ('E6102', '大学数'),
             ('E6301', '短期大学学生数'),
             ('E6302', '大学学生数')]
    ```
(ヒント) 初回のペアプロの類似問題の解答例では、組み込み関数filterとlambda関数を使用しましたが、リスト内包表記で表現した方がより簡潔です。タプルや文字列に対するインデックス参照を使用します。


4. #2のpref_listβでは抽出する地域コードを全て引数に列挙する必要がありましたが、スライスでも指定したいのでpref_sliceβ(start, stop, step=1, data=df)を作成しましょう。docstringは以下を使用しましょう。usageのコードをそのまま実行してこの結果が出るようにしましょう。
    ```code
    (args)
            start   : スライスの開始地域コード(:str)
            stop    : スライスの終了地域コード(:str)
            step=1  : スライスの間隔(:int、1がデフォルト値)
            data=df : DataFrame(dfがデフォルト値)
    (usage) >>>pprint(pref_sliceβ('R13000', 'R23000'))
            [('R13000', '東京都'),
             ('R14000', '神奈川県'),
             ('R15000', '新潟県'),
             ('R16000', '富山県'),
             ('R17000', '石川県'),
             ('R18000', '福井県'),
             ('R19000', '山梨県'),
             ('R20000', '長野県'),
             ('R21000', '岐阜県'),
             ('R22000', '静岡県'),
             ('R23000', '愛知県')]
    ```
（ヒント）コードはとてもシンプルです。スライスに文字列が使用できないので、開始位置、終了位置の取得にslice_locsメソッドを使用します。

5. 続いて、項目コードもスライス指定できるようitem_sliceβ(start, stop, step=1, data=df)を作成しましょう。docstringは以下を使用しましょう。usageのコードをそのまま実行してこの結果が出るようにしましょう。
    ```code
    (args)
            start   : スライスの開始地域コード(:str)
            stop    : スライスの終了地域コード(:str)
            step=1  : スライスの間隔(:int、1がデフォルト値)
            data=df : DataFrame(dfがデフォルト値)
    (usage) >>>pprint(item_sliceβ('E1101', 'E3501'))
            [('E1101', '幼稚園数'),
             ('E1501', '幼稚園在園者数'),
             ('E2101', '小学校数'),
             ('E2501', '小学校児童数'),
             ('E3101', '中学校数'),
             ('E3501', '中学校生徒数')]
    ```
（ヒント）前問と同じなのでヒントはありません。

6. pref_listβ()、pref_sliceβ()およびitem_sliceβ()は、引数にコードの文字列全体を指定する必要がありますが、識別可能な先頭文字列で省略できるようコードを修正し、pref_list()、pref_slice()およびitem_slice()としましょう。なお、item_slice()は省略文字列で指定する場合、item_list()と同様に同種の複数のカラムが候補となるので、startは候補の一番左側のカラムを、stopは候補の一番右側のカラムを参照するようにコードを工夫しましょう。各々のdocstringは以下を使用し、usageの通りの出力となるようにしましょう。
* 1 
     ```code
    (args)
            *keys   : 抽出対象の任意の数の地域コードを指定
            data=df : DataFram(dfがデフォルト値)
    (usage)
            >>>pprint(pref_list('R13', 'R14', 'R16', 'R17', 'R18'))
            [('R13000', '東京都'),
             ('R14000', '神奈川県'),
             ('R16000', '富山県'),
             ('R17000', '石川県'),
             ('R18000', '福井県')]
    ```

* 2 
    ```code
    (args)
            start   : スライスの開始地域コード
            stop    : スライスの終了地域コード
            step=1  : スライスの間隔(:int、1がデフォルト値)
            data=df : DataFrame(dfがデフォルト値)
    (usage) >>>pprint(pref_slice('R13', 'R20'))
            [('R13000', '東京都'),
             ('R14000', '神奈川県'),
             ('R15000', '新潟県'),
             ('R16000', '富山県'),
             ('R17000', '石川県'),
             ('R18000', '福井県'),
             ('R19000', '山梨県'),
             ('R20000', '長野県')]
    ```
* 3 
    ```code
    (args)
            start   : スライスの開始地域コード
            stop    : スライスの終了地域コード
            step=1  : スライスの間隔(1がデフォルト値)
            data=df : DataFrame(dfがデフォルト値)
    (usage) >>>pprint(item_slice('H6', 'J'))
            [('H6130', '小売店数'),
             ('H6131', '飲食店数'),
             ('H6132', '大型小売店数'),
             ('I510120', '一般病院数'),
             ('I5102', '一般診療所数'),
             ('I5103', '歯科診療所数'),
             ('I6100', '医師数'),
             ('I6200', '歯科医師数'),
             ('I6300', '薬剤師数'),
             ('J2503', '保育所等数'),
             ('J2506', '保育所等在所児数')]
    ```


7. データ加工のユーティリティとして関数をもうひとつ作りましょう。docstringは以下を使用し、usageの結果となるようにしましょう。（出力は一部省略しています）
    ```code
    項目コードの指定のみでカラム同士の割り算を行う
    (args)    a: 分子となる項目コード
              b: 分母となる項目コード
    (usage)   >>>pprint(div('I510120', 'I6100'))
              地域コード   都道府県
              R00000  全国      0.021138
              R01000  北海道     0.034885
              R02000  青森県     0.027768
              R03000  岩手県     0.028519
              R04000  宮城県     0.018319
              ...
              R45000  宮崎県     0.041681
              R46000  鹿児島県    0.042338
              R47000  沖縄県     0.019810
              dtype: float64
    ```


8. 作成した関数を使用して、データの抽出を行いましょう。
   1. まず、dfから地域コード'R26000'から'R30000'まで,項目コード'A1301', 'E1', 'E2', 'E3'のデータを抽出し、df01に代入しましょう。
   2. 次に、df01に項目コード'E1101','E1501'を利用して'幼稚園在園者数/幼稚園数'を項目コード'E1999'として、'小学校児童数/小学校数	'を項目コード'E2999'として、'中学校生徒数/中学校数'を項目コード'E3999'として作成しましょう（項目名に触れず、参照のみで作成します）。
   3. 最後に、地域コードはdf01のまま、df02に'A1301','E1501','E2501','E3501'、df03に'E1999','E2999','E3999'を項目コードとするデータを抽出して代入し、df01,df02,df03を続けて表示しましょう。（display()を使用します。）

9. #6で抽出したデータを使用してMatplotlibのグラフを作成していきます。引き続き項目名や都道府県名には触れません。また、グラフの各種属性設定は全てあとから行います。コンストラクタの引数では何も設定しません。(追加する折れ線グラフのラベルだけ例外にします)
   1.  まず、df02の全てのデータを使用して棒グラフを作成しましょう。以下のコードから開始し、以下、全てオブジェクト指向記法で記述してください。その際、x軸は項目コードなしの都道府県名となるようlebel1の値だけ抽出してください。
   2.  続いて、第2軸 axt を設定し、第2軸にdf03の全てのデータを使用して折れ線グラフを作成しましょう。（ラベルも情報として設定します）
   3.  最後にこの後の準備として、printでx軸の major_locator を表示しましょう。<matplotlib.category.StrCategoryLocator object at 0xxxxxxxxxxxxx>と表示されれば正解です。なお、棒グラフは変数 bars に、折れ線グラフは lines に格納しておきましょう。
       ```code
        fig, ax = plt.subplots()
        ```

10. #5の棒グラフを集合棒グラフに位置調整しましょう。
    1. まず、major_locatorをFixedLocatorに変更しましょう。FixedLocatorを設定するために先に以下のコードを実行しましょう。
       ```code
        from matplotlib import ticker
        ```
    2. グラフのサイズを横16インチ縦6インチに変更しましょう。（pltは使用しません）また、グラフの幅は全体で0.8になるように調整しましょう。
    3. 集合グラフの全体の幅を0.8としましょう。
    4. 凡例は、棒グラフと折れ線グラフを合算して表示できるように設定しましょう。なお、ラベルは項目名だけ表示してください。

（ヒント）figureのサイズ設定はset_size_inches、棒グラフの位置設定はset_x、幅はset_widhtメソッドを各々使用します。

