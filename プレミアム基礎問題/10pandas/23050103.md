### 23050103

```code
　SSDSE-E-2023のデータフレームdfの構成は以下の通りです。
 「項目情報」は、columnsの「項目コード」と0行目の「項目年次」、および1行目の「項目名」です。
 「地域情報」は、0列目の「地域コード」と1列目の「都道府県」です。
 
　SSDSE-E-2023のデータフレームdfは、「項目年次」は持つものの時系列データではありません。
　「項目コード」は「項目名」と「地域コード」は「都道府県」と対応していることから、ほぼ地域と項目の2次元データと見做せますが、
　ここでは3次元以上のデータを扱う際に有用なMultiIndexの練習素材として取り扱います。

```
__Theme.1（MultiIndexの設定）__

1. 最初にdf1にdfを代入しましょう。問題1の追加の工程はdf1で行います。

　行と列に含まれる「項目情報」「地域情報」をMultiIndexに設定しましょう。
　columnsは、外側から順に「項目コード」「項目の年次」「項目名」の3層のMultiIndexに設定しましょう。
　indexは、外側から順に「地域コード」「都道府県」2層のMultiIndexに設定しましょう。
　indexとcolumns各々のMultiIndexを明示的に作成し、それらをindex属性とcolumns属性に代入しましょう。
　MultiIndexの作成方法は複数ありますが、ここでは既存の行列を利用する方法としてzipメソッドとMultiIndexクラスのfrom_tuplesメソッドを使用しましょう。
　なお、indexと重複する不要な行・列は削除し、各levelのindexには項目情報と地域情報を各々のnames属性として設定しましょう。

2. 最初にdf2にdfを代入しましょう。問題2の追加の工程はdf2で行います。
　前問と同じ形状となるようにMultiIndexを設定しましょう。
　前問では明示的なMultiIndexを作成しましたが、今回はMultiIndexの設定にDataFrameのコンストラクタを使用しましょう。
　前問同様indexと重複する不要な行・列は削除し、各levelのindexには項目情報と地域情報を各々のnames属性として設定しましょう。

__Theme.2（MultiIndexの形状の変更）__

1. 最初にdf3にdf2を代入しましょう。問題3の追加の工程はdf3で行います。

　df2は「項目年次」が未整理なので整理しましょう。
　「項目年次」が「項目コード」と「項目名」の間にあるのでswaplevelメソッドを使用して外側にswapしましょう。
　その際、「項目年次」をsort_indexメソッドを使用して昇順に並び変えましょう。

4. 最初にdf4にdf2を代入しましょう。問題4の追加の工程はdf4で行います。

　今度はMultiIndexのindexとcolumnsの形状を変更しましょう。
　stackメソッドを使用してcolumnsの「項目コード」と「項目名」をindexに転回しましょう。
　indexが外側から順に「地域コード」「都道府県」「項目コード」「項目名」となるようにして、columnsは「項目年次」のみを残しましょう。
　最後に、T属性で行列を反転させましょう。

__Theme.3（MultiIndexへのデータの追加や抽出）__

5. 最初にdf5にdf3を代入しましょう。問題5の追加の工程はdf5で行います。

　df3から2020年度の病院関係のデータを抽出しましょう。
　病院関係のデータの「項目コード」は、'I510120'から'I6300'までです。　
　MultiIndexのtuple内の位置指定には、locプロパティとslice関数を使用しましょう。
　また、slice関数を使用する代わりにIndexSliceクラスを使用しても同じ結果が得られることを確認しましょう。

6. 最初にdf6にdf3を代入しましょう。問題6の追加の工程はdf6で行います。
　
これはチャレンジ問題です。できなくても問題ありませんが、こうした工夫はコーディングの効率を高める上で有益です。
　変数item_keyを定義して、例えば'A'で始まるコードというように、代入する文字列に合致する「項目コード」のデータを抽出しましょう。

　手順としてcolumnsのMultiIndexから「項目コードのlist」を抽出しましょう。
　そして、変数item_keyを「項目コードのlist」と照合して適用する「項目コード」のリストである item_codeを作成しましょう。
　それを、locプロパティとIndexSliceクラスを使用したデータ抽出のコードと組み合わせることで
　item_keyの入力から項目情報の抽出までを自動化しましょう。

7. 最初にdf7にdf5を代入しましょう。問題7の追加の工程はdf7で行います。

　「病院・診療所当り医師数」および「歯科診療所当り歯科医師数」を新しいcolumnとして追加しましょう。
　「項目コード」は、「病院・診療所当り医師数」をI9000、「歯科診療所当り歯科医師数」をI9100にしましょう。
　（「病院・診療所当り医師数」は、病院数と診療所数の合計と医師数から計算します。）

8. 最初にdf8にdf7を代入しましょう。問題8の追加の工程はdf8で行います。
 
　前問で作成した新しいcolumns「病院・診療所当り医師数」および「歯科診療所当り歯科医師数」を使用して
 「病院・診療所当り医師数」および「歯科診療所当り歯科医師数」がいずれも全国平均より多い都道府県を
 「地域コード」と「都道府県」のMultiindexで抽出しましょう。

__Theme.3 MultiIndexの次元削減__

9. 最初にdf9にdf3を代入しましょう。問題9の追加の工程はdf9で行います。
 
　今回は大学関連のデータを抽出します。大学関連の「項目コード」は'E6102'から'E6302'です。
　「地域コード」は全国（'R00000'）を除く全てのデータです。抽出にはpd.IndexSliceクラスを使用しましょう。
　次に、stackメソッドとreset_indexメソッドを使用して次元を削減しMultiIndexを削除しましょう。
　indexは「都道府県」のみ、columnsは「大学数」「大学学生数」「短期大学学生数」のみのDataFrameに変換しましょう。

__Theme.4 　データのビニング（離散化）と度数分布表__

10. 最初にdf10にdf9を代入しましょう。問題10の追加の工程はdf10で行います。
　ビニングはMultiIndexのままでは行えないため、MultiIndexではないデータを使用します。

　ビニング（データの離散化）を行い、度数分布表を作成しましょう。
　「大学数」については、cutメソッドを使用して、0から140まで20毎に区切りましょう。
　「大学学生数」については、cutメソッドを使用して数値を最小値から最大値まで5分割しましょう。
　「短期大学学生数」については、qcutメソッドを使用して要素数を5分割しましょう。
　いずれの場合も、左側が「開区間」右側が「閉区間」の設定で表示しましょう。